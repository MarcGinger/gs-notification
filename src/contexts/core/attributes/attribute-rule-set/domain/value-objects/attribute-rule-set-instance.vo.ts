// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import { DomainError, Result, ok, err } from 'src/shared/errors';
import {
  createIntegerVO,
  createIntegerVOErrors,
  IntegerVOInstance,
  createDateTimeVO,
  createDateTimeVOErrors,
  DateTimeVOInstance,
} from 'src/shared/domain/value-objects';
import { Clock } from 'src/shared/domain/clock';
import { AttributeRuleSetErrors } from '../errors/attribute-rule-set.errors';

/**
 * AttributeRuleSet Instance Value Objects
 *
 * Instance VOs for AttributeRuleSet aggregate lifecycle management.
 * Includes creation timestamps, update timestamps, and version tracking.
 * Follows the Clock injection pattern for deterministic testing.
 */

// ===========================================
// AttributeRuleSet Created At Instance VO
// ===========================================

const AttributeRuleSetCreatedAtErrors = createDateTimeVOErrors(
  AttributeRuleSetErrors.CREATED_AT_REQUIRED,
  'AttributeRuleSet Created At',
);

export const AttributeRuleSetCreatedAt = createDateTimeVO({
  name: 'AttributeRuleSetCreatedAt',
  allowFuture: false, // Cannot create attribute_rule_set in the future
  allowPast: true, // Can create with past timestamps (data migration)
  customValidation: (date: Date): Result<void, DomainError> => {
    // Optional: Add domain-specific creation time validation
    // For example, cannot be more than 1 year in the past
    const oneYearAgo = new Date();
    oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);

    if (date < oneYearAgo) {
      return err({
        ...AttributeRuleSetErrors.CREATED_AT_REQUIRED,
        detail:
          'AttributeRuleSet creation date cannot be more than 1 year in the past',
        context: { value: date, maxPastDate: oneYearAgo },
      } as DomainError);
    }

    return ok(undefined);
  },
  errors: AttributeRuleSetCreatedAtErrors,
});

export type AttributeRuleSetCreatedAt = DateTimeVOInstance;

// ===========================================
// AttributeRuleSet Updated At Instance VO
// ===========================================

const AttributeRuleSetUpdatedAtErrors = createDateTimeVOErrors(
  AttributeRuleSetErrors.UPDATED_AT_REQUIRED,
  'AttributeRuleSet Updated At',
);

export const AttributeRuleSetUpdatedAt = createDateTimeVO({
  name: 'AttributeRuleSetUpdatedAt',
  allowFuture: false, // Cannot update attribute_rule_set in the future
  allowPast: true, // Can update with past timestamps (data correction)
  errors: AttributeRuleSetUpdatedAtErrors,
});

export type AttributeRuleSetUpdatedAt = DateTimeVOInstance;

// ===========================================
// AttributeRuleSet Version Instance VO
// ===========================================

const AttributeRuleSetVersionErrors = createIntegerVOErrors(
  AttributeRuleSetErrors.INVALID_CODE_DATA, // Reusing existing error until specific version error is added
  'AttributeRuleSet Version',
);

export const AttributeRuleSetVersion = createIntegerVO({
  name: 'AttributeRuleSetVersion',
  min: 0, // Version starts at 0
  allowNegative: false,
  errors: AttributeRuleSetVersionErrors,
});

export type AttributeRuleSetVersion = IntegerVOInstance;

// ===========================================
// Clock-Based Helper Functions (Explicit Dependencies)
// ===========================================

/**
 * Create AttributeRuleSetCreatedAt from Clock (explicit dependency)
 * Deterministic and testable - pass a fake clock in tests
 */
export const createdAtNow = (
  clock: Clock,
): Result<AttributeRuleSetCreatedAt, DomainError> =>
  AttributeRuleSetCreatedAt.create(clock.now());

/**
 * Create AttributeRuleSetUpdatedAt from Clock (explicit dependency)
 * Deterministic and testable - pass a fake clock in tests
 */
export const updatedAtNow = (
  clock: Clock,
): Result<AttributeRuleSetUpdatedAt, DomainError> =>
  AttributeRuleSetUpdatedAt.create(clock.now());

/**
 * Bump version by 1 (domain business rule)
 */
export const bumpVersion = (
  currentVersion: AttributeRuleSetVersion,
): Result<AttributeRuleSetVersion, DomainError> =>
  AttributeRuleSetVersion.create(currentVersion.value + 1);

/**
 * Create initial version (starts at 1 for new aggregates)
 */
export const initialVersion = (): Result<
  AttributeRuleSetVersion,
  DomainError
> => AttributeRuleSetVersion.create(1);

// ===========================================
// Direct Creation Functions (Non-Clock Based)
// ===========================================

/**
 * Create AttributeRuleSetCreatedAt from Date
 */
export const createAttributeRuleSetCreatedAt = (
  date: Date,
): Result<AttributeRuleSetCreatedAt, DomainError> =>
  AttributeRuleSetCreatedAt.create(date);

/**
 * Create AttributeRuleSetUpdatedAt from Date
 */
export const createAttributeRuleSetUpdatedAt = (
  date: Date,
): Result<AttributeRuleSetUpdatedAt, DomainError> =>
  AttributeRuleSetUpdatedAt.create(date);

/**
 * Create AttributeRuleSetVersion from number
 */
export const createAttributeRuleSetVersion = (
  version: number,
): Result<AttributeRuleSetVersion, DomainError> =>
  AttributeRuleSetVersion.create(version);

// ===========================================
// Domain Invariants & Validation
// ===========================================

/**
 * Validate that updatedAt is not before createdAt (monotonic time)
 */
export const validateMonotonicTime = (
  createdAt: AttributeRuleSetCreatedAt,
  updatedAt: AttributeRuleSetUpdatedAt,
): Result<void, DomainError> => {
  if (updatedAt.value < createdAt.value) {
    return err({
      ...AttributeRuleSetErrors.UPDATED_AT_REQUIRED,
      detail: 'Updated at cannot be before created at',
      context: {
        createdAt: createdAt.value.toISOString(),
        updatedAt: updatedAt.value.toISOString(),
      },
    } as DomainError);
  }
  return ok(undefined);
};

// ===========================================
// Legacy Compatibility (DEPRECATED)
// ===========================================

/**
 * @deprecated Use createdAtNow(clock) instead for better testability
 * This function hides the Date dependency and makes testing harder
 */
export function createAttributeRuleSetCreatedAtNow(): Result<
  AttributeRuleSetCreatedAt,
  DomainError
> {
  return AttributeRuleSetCreatedAt.create(new Date());
}

/**
 * @deprecated Use updatedAtNow(clock) instead for better testability
 * This function hides the Date dependency and makes testing harder
 */
export function createAttributeRuleSetUpdatedAtNow(): Result<
  AttributeRuleSetUpdatedAt,
  DomainError
> {
  return AttributeRuleSetUpdatedAt.create(new Date());
}
