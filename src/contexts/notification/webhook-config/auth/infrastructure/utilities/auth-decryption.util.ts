// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import { Logger } from 'src/shared/logging';
import { ActorContext } from 'src/shared/application/context';
import { EventEncryptionFactory } from 'src/shared/infrastructure/encryption';
import { SecretRefDecryptionUtil } from 'src/shared/infrastructure/encryption/utilities/secret-ref-decryption.util';
import { AuthEncryptionConfig } from '../encryption/auth-encryption.config';

/**
 * Auth Decryption Utility
 *
 * Domain-specific wrapper around the shared SecretRefDecryptionUtil.
 * Provides Auth-specific convenience methods while leveraging
 * the shared decryption infrastructure.
 *
 * This utility:
 * 1. Uses shared SecretRefDecryptionUtil for common decryption pipeline
 * 2. Applies Auth-specific encryption configuration
 * 3. Provides typed convenience methods for common Auth fields
 * 4. Maintains domain-specific context and error handling
 *
 * Used by both AuthQueryRepository and AuthReaderRepository
 * to eliminate code duplication and ensure consistent decryption behavior.
 *
 * @domain Notification Context - Auth Decryption Utility
 * @layer Infrastructure
 * @pattern Domain-Specific Wrapper + Shared Infrastructure
 */
export class AuthDecryptionUtil {
  /**
   * Parse and decrypt SecretRef fields using shared SecretRefDecryptionUtil
   *
   * Auth-specific wrapper around the shared SecretRefDecryptionUtil.
   * Uses Auth encryption configuration and event types while leveraging
   * the common decryption pipeline.
   *
   * @param secretFields - Record of field names to encrypted values (JSON strings or plain strings)
   * @param actor - Actor context for decryption
   * @param eventEncryptionFactory - Factory for handling encryption/decryption operations
   * @param logger - Logger instance for error reporting
   * @returns Promise resolving to record of field names to decrypted string values
   */
  static async decryptAuthFields(
    secretFields: Record<string, string | undefined>,
    actor: ActorContext,
    eventEncryptionFactory: EventEncryptionFactory,
    logger: Logger,
  ): Promise<Record<string, string | undefined>> {
    const secretConfig = AuthEncryptionConfig.createSecretRefConfig();

    return SecretRefDecryptionUtil.decryptSecretRefFields(
      secretFields,
      actor,
      eventEncryptionFactory,
      secretConfig,
      'AuthQuery',
      logger,
      {
        method: 'AuthDecryptionUtil.decryptSecretRefFields',
        domain: 'Auth',
      },
    );
  }
}
