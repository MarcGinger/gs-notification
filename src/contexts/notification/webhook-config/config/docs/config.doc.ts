// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';
import { INestApplication } from '@nestjs/common';
import { SwaggerConfigUtil } from 'src/docs/swagger-config.util';
import { ConfigModule } from '../config.module';
/**
 * Config documentation endpoints interface
 */
export interface ConfigDocumentationUrls {
  config: string;
}

/**
 * Config Documentation
 * This module handles the Swagger documentation for configs
 *
 */
export class ConfigDocumentation {
  static setup(app: INestApplication, port: string | number): void {
    const config = new DocumentBuilder()
      .addBearerAuth(
        { type: 'http', scheme: 'bearer', bearerFormat: 'JWT' },
        'bearer',
      )
      .setTitle('üì± Config Management API')
      .setDescription(
        `
## bounded context: notification
[‚Üê Back to documentation](/api/docs/notification)

### application: webhook-config
[‚Üê Back to documentation](/api/docs/notification/webhook-config)
# üß© Core Webhook Config ‚Äî General Overview

The **Core Webhook Config** service is part of the broader **Notification Bounded Context**, responsible for managing all configuration aspects required to send outbound webhooks within the platform. It provides the infrastructure and domain logic that connects a tenant‚Äôs webhook endpoints to the notification ecosystem, ensuring secure, structured, and compliant communication between services and external systems.

---

## üéØ Purpose

The primary purpose of **Core Webhook Config** is to manage the lifecycle of webhook-related configuration for each tenant. It defines *where*, *how*, and *under what conditions* webhook payloads are sent. By maintaining configurations in a domain-driven, event-sourced model, the service guarantees auditability, tenant isolation, and consistency across all webhook-related operations.

---

## üß± Architectural Role

**Core Webhook Config** acts as the **configuration source of truth** for all webhook integrations in the system. It is not responsible for executing HTTP requests (that‚Äôs handled by the **Core Webhook Execute** service), but instead manages the metadata, headers, secrets, retry strategies, and operational policies that determine how webhooks are delivered and authorized.

### Key Roles:

* Acts as the *control plane* for webhook delivery configuration.
* Provides secure storage and reference handling for signing secrets.
* Defines approved target URLs and subscribed event types.
* Publishes domain events consumed by other services (e.g., executors, auditors, or workflow engines).
* Ensures compliance with audit and retry policies via event sourcing.

---

## ‚öôÔ∏è Core Components

| Aggregate   | Description                                                                                                     |
| ----------- | --------------------------------------------------------------------------------------------------------------- |
| **Webhook** | Represents an outbound webhook endpoint, including target URL, subscribed event types, HTTP method, and status. |
| **Config**  | Defines retry/backoff strategies, timeout settings, and operational parameters controlling webhook execution.   |

Each aggregate is event-sourced and projected into Redis for fast reads. The system follows a **CQRS pattern**, separating command writes (EventStoreDB) from queries (Redis projections).

---

## üß© Data Flow Summary

\`\`\`
[API Command] ‚Üí [Use Case] ‚Üí [ESDB Writer Repository] ‚Üí [EventStoreDB]
       ‚Üì
[Central Projection Service] ‚Üí [Redis Snapshot] + [Redis Query Index]
       ‚Üì
[Query API] ‚Üí [Executor / UI / Workflow Consumers]
\`\`\`

This architecture provides full event auditability in **EventStoreDB**, real-time read performance in **Redis**, and flexible event-driven synchronization via **BullMQ** projectors.

---

## üõ°Ô∏è Security and Compliance

* **Authentication:** Managed via Keycloak (OAuth2 / OpenID Connect).
* **Authorization:** Governed by Open Policy Agent (OPA) Rego policies.
* **Secret Management:** Signing secrets are stored securely using Doppler or another approved secret manager.
* **Auditability:** Every configuration change emits domain events stored in EventStoreDB, ensuring immutable history and traceability.

---

## üöÄ Example Use Cases

| Use Case                 | Description                                                                                                         |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------- |
| **Webhook Registration** | When a new webhook is added for a tenant, \`WebhookRegistered.v1\` and \`ConfigUpdated.v1\` events are emitted.         |
| **Retry Policy Update**  | Admins can update retry and timeout parameters, triggering \`ConfigUpdated.v1\` for executor synchronization.         |
| **Secret Rotation**      | When a signing secret is rotated, the service emits a new versioned event and updates downstream projections.       |
| **Subscription Change**  | Tenants can modify the event types their webhook subscribes to, updating routing and executor behavior dynamically. |

---

## ‚úÖ Benefits

* **Event-Sourced Reliability:** Every change is versioned, replayable, and fully auditable.
* **Tenant Isolation:** Each webhook configuration is scoped to a tenant.
* **High Performance:** Read models are served from Redis with millisecond-level latency.
* **Extensible Design:** Supports additional delivery settings (e.g., per-event policies, delivery headers) in future iterations.
* **Integration Friendly:** Provides consistent event naming and structure compatible with other notification channels (Slack, Email, SMS).

---

## üß© Summary

The **Core Webhook Config** service provides the configuration backbone for all webhook-based notifications. It ensures that every outbound webhook:

* Is securely configured and authorized.
* Uses approved and auditable endpoints.
* Follows consistent retry and timeout policies.
* Operates under event-sourced, tenant-aware control.

This service is a critical component of the Notification Bounded Context, enabling scalable, reliable, and compliant webhook integration within a modern, event-driven architecture.

---

## üîó Webhook

### **Purpose**

The \`Webhook\` aggregate represents a webhook endpoint configuration for delivering events to external systems. It acts as the foundational configuration point that defines how, where, and under what conditions webhook notifications are sent.

This aggregate holds delivery configuration including target URLs, HTTP methods, headers, signing secrets, and operational settings. It ensures webhook deliveries are properly configured and can be managed independently.

### **Responsibilities**

* Define webhook endpoint details (URL, method, headers).
* Manage webhook operational status (active, paused, disabled).
* Store webhook-specific timeout and TLS verification settings.
* Reference signing secrets for webhook authentication.
* Emit events when webhook configuration changes occur.

### **Why It Matters**

The \`Webhook\` aggregate provides the essential configuration for reliable event delivery to external systems. It ensures proper authentication, timeout handling, and operational control over webhook endpoints.

---

## ‚öôÔ∏è Config

### **Purpose**

The \`Config\` aggregate manages system-wide operational parameters for webhook delivery within a tenant‚Äôs environment. It defines how webhook executions behave under various runtime conditions, such as retries, backoff, timeouts, and logging.

This configuration ensures webhook delivery is resilient and aligned with organizational policies (e.g., retry intervals, maximum attempts, request timeouts, or whether to include audit metadata in headers).

### **Responsibilities**

* Manage retry and backoff policies for webhook execution.
* Control request timeout and connection settings for external calls.
* Define signature and security parameters for webhook authentication.
* Maintain default locale, metadata, and operational strategies (e.g., per-tenant or global).
* Emit configuration change events for synchronization across executor services.

### **Why It Matters**

\`Config\` provides the **operational backbone** for webhook execution. It ensures reliability, observability, and compliance ‚Äî allowing organizations to define consistent behavior for webhook notifications at scale and under failure conditions.
`,
      )
      .setVersion('1.0.0')
      .addTag('Configs', `Configuration for config table`);

    // Add dynamic server configuration
    SwaggerConfigUtil.addServers(config, port);

    const document = SwaggerModule.createDocument(app, config.build(), {
      include: [ConfigModule],
      extraModels: [],
    });

    SwaggerModule.setup(
      'api/docs/notification/webhook-config/config',
      app,
      document,
    );
  }

  /**
   * Setup all config-related documentation endpoints
   * This method centralizes the setup of all config module documentation
   */
  static setupAll(
    app: INestApplication,
    port: string | number,
  ): ConfigDocumentationUrls {
    // Setup main config documentation
    ConfigDocumentation.setup(app, port);

    // Setup sub-module documentation

    // Return all endpoint URLs
    return {
      config: ConfigDocumentation.getEndpoint(port),
    };
  }

  static getEndpoint(port: string | number): string {
    return `${SwaggerConfigUtil.getServerUrl(port)}/api/docs/notification/webhook-config/config`;
  }
}
