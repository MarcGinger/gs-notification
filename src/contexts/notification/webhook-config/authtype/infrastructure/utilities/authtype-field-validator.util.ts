// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import {
  safeParseJSON,
  safeParseJSONArray,
} from 'src/shared/infrastructure/repositories';
import { EventDataProcessingUtils } from 'src/shared/infrastructure/events/utilities/event-data-processing.utils';
import {
  AuthtypeSignatureAlgorithmValue,
  AuthtypeTypeValue,
} from '../../application/dtos';

/**
 * Authtype Field Validator Utility
 *
 * Centralized utility for parsing and validating Authtype aggregate data from EventStore events.
 * Provides consistent field validation patterns that can be reused across repositories
 * and projectors for Authtype domain operations.
 *
 * @domain Notification Context - Authtype Field Validation Utility
 * @layer Infrastructure
 * @pattern Utility Pattern + Field Validation
 */
export class AuthtypeFieldValidatorUtil {
  /**
   * Create projector data with Authtype objects for Redis storage
   *
   * This method extracts Authtype objects from event data and serializes them
   * as JSON strings for storage in Redis. The reader repository will deserialize
   * and resolve these Authtype objects back to actual secret values.
   *
   * @param aggregateData - Raw event data from EventStore containing Authtype objects
   * @returns Projector data object with Authtype fields as JSON strings
   */
  static createAuthtypeProjectorDataFromEventData(
    aggregateData: Record<string, any>,
  ): {
    id: string;
    webhookId: string;
    type: AuthtypeTypeValue;
    signingSecretRef?: string;
    signatureAlgorithm?: AuthtypeSignatureAlgorithmValue;
    usernameRef?: string;
    passwordRef?: string;
    apiKeyRef?: string;
    apiKeyHeader?: string;
    apiKeyQueryParam?: string;
    tokenUrl?: string;
    clientIdRef?: string;
    clientSecretRef?: string;
    scope?: string;
    certRef?: string;
    keyRef?: string;
    caRef?: string;
    version: number;
    createdAt: Date;
    updatedAt: Date;
  } {
    // Parse array fields using safeParseJSONArray utility
    // Extract simple fields directly from event data
    const id = aggregateData.id as string;
    const webhookId = aggregateData.webhookId as string;
    const type = aggregateData.type as AuthtypeTypeValue;
    const signingSecretRef = aggregateData.signingSecretRef as string;
    const signatureAlgorithm =
      aggregateData.signatureAlgorithm as AuthtypeSignatureAlgorithmValue;
    const usernameRef = aggregateData.usernameRef as string;
    const passwordRef = aggregateData.passwordRef as string;
    const apiKeyRef = aggregateData.apiKeyRef as string;
    const apiKeyHeader = aggregateData.apiKeyHeader as string;
    const apiKeyQueryParam = aggregateData.apiKeyQueryParam as string;
    const tokenUrl = aggregateData.tokenUrl as string;
    const clientIdRef = aggregateData.clientIdRef as string;
    const clientSecretRef = aggregateData.clientSecretRef as string;
    const scope = aggregateData.scope as string;
    const certRef = aggregateData.certRef as string;
    const keyRef = aggregateData.keyRef as string;
    const caRef = aggregateData.caRef as string;

    // Store plain text values directly for now (not encrypted)
    // This preserves the user-provided values per record
    // Extract credentials for validation (they're handled via Authtype below)

    // Extract version and timestamps with proper type conversion
    const version = EventDataProcessingUtils.extractVersion(aggregateData);
    const { createdAt, updatedAt } =
      EventDataProcessingUtils.extractTimestamps(aggregateData);

    // safeParseJSON utilities provide error handling for invalid JSON,
    // direct field access provides type safety and truthful representation
    return {
      id,
      webhookId,
      type,
      signingSecretRef,
      signatureAlgorithm,
      usernameRef,
      passwordRef,
      apiKeyRef,
      apiKeyHeader,
      apiKeyQueryParam,
      tokenUrl,
      clientIdRef,
      clientSecretRef,
      scope,
      certRef,
      keyRef,
      caRef,
      version,
      createdAt,
      updatedAt,
    };
  }
}
