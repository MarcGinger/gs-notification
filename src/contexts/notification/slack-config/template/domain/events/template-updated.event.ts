// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import { EventMetadata } from 'src/shared/domain/events';
import type { TemplateSnapshotProps } from '../props';

/**
 * Template change tracking interface
 * Used to track field-level changes in template updates
 */
export interface TemplateChangeSet {
  workspaceId?: { old: string[]; new: string[] };
  name?: { old: string; new: string };
  description?: { old?: string | undefined; new?: string | undefined };
  contentBlocks?: {
    old: Record<string, unknown>;
    new: Record<string, unknown>;
  };
  variables?: {
    old?: Record<string, unknown> | undefined;
    new?: Record<string, unknown> | undefined;
  };
  samplePayload?: {
    old?: Record<string, unknown> | undefined;
    new?: Record<string, unknown> | undefined;
  };
  enabled?: { old: boolean; new: boolean };
}

/**
 * Template Updated Event Payload
 * Contains information about what fields were changed in the template
 */
export interface TemplateUpdatedEventPayload {
  code: string;
  before: TemplateSnapshotProps;
  after: TemplateSnapshotProps;
  changes: TemplateChangeSet;
  version: number;
  updatedAt: Date;
  metadata: EventMetadata;
}

/**
 * Template Updated Domain Event
 *
 * Emitted when template information is modified.
 * Contains change tracking information and update metadata.
 */
export class TemplateUpdatedEvent {
  public readonly eventType = 'NotificationSlackConfigTemplateUpdated.v1';
  public readonly eventVersion = 'v1';

  constructor(public readonly payload: TemplateUpdatedEventPayload) {}

  // Factory method with security context
  static create(
    data: Omit<TemplateUpdatedEventPayload, 'metadata'>,
    baseMetadata: EventMetadata,
  ): TemplateUpdatedEvent {
    const metadata: EventMetadata = {
      ...baseMetadata,
      eventVersion: '1.0',
      source: 'notification.domain.template',
    };

    return new TemplateUpdatedEvent({
      ...data,
      metadata,
    });
  }

  get code(): string {
    return this.payload.code;
  }

  get changes(): TemplateChangeSet {
    return this.payload.changes;
  }

  get version(): number {
    return this.payload.version;
  }

  get updatedAt(): Date {
    return this.payload.updatedAt;
  }

  get metadata(): EventMetadata {
    return this.payload.metadata;
  }
}
