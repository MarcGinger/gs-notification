// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

/**
 * ChannelRow - Core Database Schema Interface
 *
 * Represents the actual PostgreSQL table structure for the "slack_config"."channels" table.
 * This is the authoritative schema used by all read and query operations.
 *
 * Database Table: "slack_config"."channels"
 * Schema Version: 1.0.0
 *
 * Key Design Decisions:
 * - JSONB fields (workspace_code) stored as string and parsed at runtime for type safety
 * - Snake_case field names match PostgreSQL conventions
 * - Nullable fields explicitly marked for proper type checking
 * - Version field supports optimistic concurrency control
 * - Audit fields (created_at, updated_at) for change tracking
 * - Date fields returned as JS Date objects (ensure pg driver is configured properly)
 *
 * @layer Infrastructure - Database Schema
 * @pattern Shared Schema Definition
 */
export interface ChannelRow {
  code: string;
  name: string;
  workspace_code: string;
  is_private: boolean;
  is_dm: boolean;
  topic: string | null;
  purpose: string | null;
  subscribed_events: string | null; // JSON string containing string[] array
  enabled: boolean;

  version: number;
  created_at: Date;
  updated_at: Date;
}

/**
 * Minimal ChannelRow interface for existence checks and write-path optimizations
 */
export interface ChannelMinimalRow {
  code: string;
  version: number;
}

/**
 * Version-only ChannelRow interface for optimistic concurrency control
 */
export interface ChannelVersionRow {
  version: number;
}

/**
 * Existence-check ChannelRow interface for boolean existence queries
 */
export interface ChannelExistsRow {
  exists: boolean;
}

/**
 * Upsert result ChannelRow interface for insert/update operations
 */
export interface ChannelUpsertResult {
  version: number;
}

/**
 * Delete result ChannelRow interface for delete operations
 */
export interface ChannelDeleteResult {
  version: number;
}

/**
 * Extended ChannelRow interface for projector operations
 * Includes additional fields needed for event sourcing projections
 */
export interface ChannelProjectionRow extends ChannelRow {
  tenant_id: string;
  deleted_at: Date | null;
  last_stream_revision: string | null;
}

/**
 * Projection upsert result interface for projector operations
 */
export interface ChannelProjectionUpsertResult {
  code: string;
  version: number;
}

/**
 * ChannelRowQueries - Centralized SQL Query Definitions
 *
 * Contains all SQL queries used by Channel repositories and services.
 * Centralizes query definitions for better maintainability and consistency.
 *
 * Query Design Principles:
 * - Parameterized queries for security (SQL injection prevention)
 * - Optimized with proper indexing assumptions (ensure indexes exist on tenant_id, code, active)
 * - Consistent naming and formatting across all queries
 * - Performance-optimized with appropriate operators and LIMIT clauses
 * - Business logic filtering removed - repository returns all data, business layer filters
 *
 * @layer Infrastructure - Database Queries
 * @pattern Centralized Query Repository
 */
export class ChannelRowQueries {
  /**
   * Find channel by code for full snapshot retrieval
   * Returns complete channel data including all JSONB fields
   * Business layer should filter by active status as needed
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   *
   * Performance Notes:
   * - Uses LIMIT 1 for single record optimization
   * - Includes all JSONB fields for complete snapshot
   *
   * Indexes used:
   * - channels_tenant_code_idx (tenant_id, code)
   */
  static readonly FIND_CHANNEL_BY_CODE = `
    SELECT code, name, workspace_code, is_private, is_dm, topic, purpose, subscribed_events, enabled, created_at, updated_at, version
    FROM "slack_config"."channels" 
    WHERE tenant_id = $1 
      AND code = $2
    LIMIT 1
  `;

  /**
   * Check if a channel exists by code
   * Optimized existence check without fetching full data
   * Business layer should check active status separately if needed
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   */
  static readonly CHECK_CHANNEL_EXISTS = `
    SELECT EXISTS(
      SELECT 1 FROM "slack_config"."channels" 
      WHERE tenant_id = $1 AND code = $2
    ) as exists
  `;

  /**
   * Get channel version for optimistic concurrency control
   * Returns only version field for minimal data transfer
   * Business layer should check active status separately if needed
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   */
  static readonly GET_CHANNEL_VERSION = `
    SELECT version
    FROM "slack_config"."channels" 
    WHERE tenant_id = $1 AND code = $2
    LIMIT 1
  `;

  /**
   * Get minimal channel data for write-path optimizations
   * Returns only code and version fields for lightweight operations
   * Business layer should check active status separately if needed
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   */
  static readonly GET_CHANNEL_MINIMAL = `
    SELECT code, version
    FROM "slack_config"."channels" 
    WHERE tenant_id = $1 AND code = $2
    LIMIT 1
  `;

  /**
   * Count channels for pagination with dynamic filtering
   * Optimized count query for pagination metadata
   * Supports dynamic WHERE conditions for filtering
   *
   * Usage Pattern:
   * - Repository builds WHERE conditions dynamically
   * - First parameter is always tenant_id ($1)
   * - Additional filter parameters follow sequentially
   *
   * Performance Notes:
   * - Uses COUNT(*) for efficiency
   * - Leverages index on tenant_id for fast counting
   * - WHERE conditions should use parameterized queries
   *
   * Indexes used:
   * - channels_tenant_idx (tenant_id)
   * - channels_tenant_code_idx (tenant_id, code) for code filters
   * - channel_tenant_name_idx (tenant_id, name) for name filters
   * - channel_tenant_workspace_code_idx (tenant_id, workspace_code) for workspaceCode filters
   */
  static readonly COUNT_CHANNELS_BASE = `
    SELECT COUNT(*) as total
    FROM "slack_config"."channels"
  `;

  /**
   * Find channels with pagination and dynamic filtering
   * Returns complete channel data for query operations
   * Supports dynamic WHERE conditions, ORDER BY, and LIMIT/OFFSET
   *
   * Usage Pattern:
   * - Repository builds complete query with WHERE, ORDER BY, LIMIT, OFFSET
   * - First parameter is always tenant_id ($1)
   * - Additional filter parameters follow sequentially
   * - Last two parameters are LIMIT and OFFSET for pagination
   *
   * Performance Notes:
   * - Uses consistent column list with FIND_CHANNEL_BY_CODE
   * - Includes all JSONB fields for complete data retrieval
   * - ORDER BY should use indexed columns for performance
   * - LIMIT/OFFSET for efficient pagination
   *
   * Indexes used:
   * - channels_tenant_idx (tenant_id)
   * - channels_tenant_code_idx (tenant_id, code) for code filters and sorting
   * - channel_tenant_name_idx (tenant_id, name) for name filters and sorting
   * - channel_tenant_workspace_code_idx (tenant_id, workspace_code) for workspaceCode filters and sorting
   */
  static readonly FIND_CHANNELS_PAGINATED_BASE = `
    SELECT code, name, workspace_code, is_private, is_dm, topic, purpose, subscribed_events, enabled, created_at, updated_at, version
    FROM "slack_config"."channels"
  `;

  /**
   * Upsert channel (INSERT or UPDATE on conflict)
   * Handles both create and update operations atomically
   * Returns the version of the inserted/updated record
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   * - $3: name (string)
   * - $4: workspace_code (string)
   * - $5: is_private (boolean)
   * - $6: is_dm (boolean)
   * - $7: topic (string | null)
   * - $8: purpose (string | null)
   * - $9: subscribed_events (string | null)
   * - $10: enabled (boolean)
   * - $11: version (number)
   * - $12: created_at (Date)
   * - $13: updated_at (Date)
   *
   * Performance Notes:
   * - Uses ON CONFLICT for atomic upsert operation
   * - Updates all fields on conflict to ensure data consistency
   * - Returns version for optimistic concurrency control
   *
   * Indexes used:
   * - channels_tenant_code_idx (tenant_id, code) for conflict detection
   */
  static readonly UPSERT_CHANNEL = `
    INSERT INTO "slack_config"."channels" (
      tenant_id, code, name, workspace_code, is_private, is_dm, topic, purpose, subscribed_events, enabled, version, created_at, updated_at
    ) VALUES (
      $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13
    )
    ON CONFLICT (tenant_id, code) 
    DO UPDATE SET
      name = EXCLUDED.name,
      workspace_code = EXCLUDED.workspace_code,
      is_private = EXCLUDED.is_private,
      is_dm = EXCLUDED.is_dm,
      topic = EXCLUDED.topic,
      purpose = EXCLUDED.purpose,
      subscribed_events = EXCLUDED.subscribed_events,
      enabled = EXCLUDED.enabled,
      version = EXCLUDED.version,
      updated_at = EXCLUDED.updated_at
    RETURNING version;
  `;

  /**
   * Delete channel by tenant_id and code
   * Hard delete operation for complete removal
   * Returns the version of the deleted record for audit purposes
   *
   * Parameters:
   * - $1: tenant_id (string)
   * - $2: code (string)
   *
   * Performance Notes:
   * - Returns version before deletion for audit trail
   * - Uses RETURNING clause to confirm deletion
   * - Will return no rows if channel doesn't exist
   *
   * Indexes used:
   * - channels_tenant_code_idx (tenant_id, code)
   */
  static readonly DELETE_CHANNEL = `
    DELETE FROM "slack_config"."channels" 
    WHERE tenant_id = $1 AND code = $2
    RETURNING version;
  `;

  /**
   * Upsert channel for projector (INSERT or UPDATE on conflict)
   * Extended version with projector-specific fields for event sourcing
   * Returns code and version of the inserted/updated record
   *
   * Parameters:
   * - $1: code (string)
   * - $2: name (string)
   * - $3: workspace_code (string)
   * - $4: is_private (boolean)
   * - $5: is_dm (boolean)
   * - $6: topic (string | null)
   * - $7: purpose (string | null)
   * - $8: subscribed_events (string | null)
   * - $9: enabled (boolean)
   * - $10: tenant_id (string)
   * - $11: version (number)
   * - $12: created_at (Date)
   * - $13: updated_at (Date)
   * - $14: deleted_at (Date | null)
   * - $15: last_stream_revision (string | null)
   *
   * Performance Notes:
   * - Uses ON CONFLICT for atomic upsert operation
   * - Includes optimistic concurrency control with version check
   * - Returns code and version for projection tracking
   * - Supports soft delete via deleted_at field
   *
   * Indexes used:
   * - channels_tenant_code_idx (tenant_id, code) for conflict detection
   */
  static readonly UPSERT_CHANNEL_PROJECTION = `
    INSERT INTO "slack_config"."channels" AS p (
      code, 
      name, 
      workspace_code, 
      is_private, 
      is_dm, 
      topic, 
      purpose, 
      subscribed_events, 
      enabled, 
      tenant_id, 
      version, 
      created_at, 
      updated_at, 
      deleted_at, 
      last_stream_revision
    ) VALUES (
      $1,  -- code
      $2,  -- name
      $3,  -- workspace_code
      $4,  -- is_private
      $5,  -- is_dm
      $6,  -- topic
      $7,  -- purpose
      $8,  -- subscribed_events
      $9,  -- enabled
      $10, -- tenant_id
      $11, -- version
      $12, -- created_at
      $13, -- updated_at
      $14, -- deleted_at
      $15  -- last_stream_revision
    )
    ON CONFLICT (tenant_id, code)
    DO UPDATE SET
      name = EXCLUDED.name,
      workspace_code = EXCLUDED.workspace_code,
      is_private = EXCLUDED.is_private,
      is_dm = EXCLUDED.is_dm,
      topic = EXCLUDED.topic,
      purpose = EXCLUDED.purpose,
      subscribed_events = EXCLUDED.subscribed_events,
      enabled = EXCLUDED.enabled,
      version = EXCLUDED.version,
      updated_at = EXCLUDED.updated_at,
      deleted_at = EXCLUDED.deleted_at,
      last_stream_revision = EXCLUDED.last_stream_revision
    WHERE p.version < EXCLUDED.version
    RETURNING code, version;
  `;
}

/**
 * ChannelRowMappers - Centralized Mapping Functions
 *
 * Contains all mapping functions to convert database rows to domain objects.
 * Centralizes mapping logic for consistency and reusability.
 *
 * Mapping Design Principles:
 * - Null-safe mapping with proper default handling
 * - Type-safe conversions with validation
 * - Consistent field naming conventions
 * - Error handling for malformed JSON data
 * - Safe parsing of JSONB and JSON array fields
 *
 * @layer Infrastructure - Data Mapping
 * @pattern Centralized Mapper Repository
 */
export class ChannelRowMappers {
  /**
   * Map ChannelExistsRow to boolean for existence checks
   * Simple extraction utility for existence queries
   *
   * @param row - Database row with exists field
   * @returns Boolean indicating existence
   */
  static mapToExists(row: ChannelExistsRow): boolean {
    return row.exists;
  }

  /**
   * Map ChannelVersionRow to number for version extraction
   * Simple extraction utility for version queries
   *
   * @param row - Database row with version field
   * @returns Version number
   */
  static mapToVersion(row: ChannelVersionRow): number {
    return row.version;
  }

  /**
   * Map ChannelMinimalRow to minimal channel object
   * Simple extraction utility for minimal queries
   *
   * @param row - Database row with code and version fields
   * @returns Minimal channel object
   */
  static mapToMinimal(row: ChannelMinimalRow): {
    code: string;
    version: number;
  } {
    return {
      code: row.code,
      version: row.version,
    };
  }

  /**
   * Map ChannelUpsertResult to version number for upsert operations
   * Simple extraction utility for upsert operation results
   *
   * @param row - Database row with version field from RETURNING clause
   * @returns Version number of upserted record
   */
  static mapToUpsertResult(row: ChannelUpsertResult): number {
    return row.version;
  }

  /**
   * Map ChannelDeleteResult to version number for delete operations
   * Simple extraction utility for delete operation results
   *
   * @param row - Database row with version field from RETURNING clause
   * @returns Version number of deleted record
   */
  static mapToDeleteResult(row: ChannelDeleteResult): number {
    return row.version;
  }

  /**
   * Map ChannelProjectionUpsertResult to projection result for projector operations
   * Simple extraction utility for projection upsert operation results
   *
   * @param row - Database row with code and version fields from RETURNING clause
   * @returns Projection result with code and version
   */
  static mapToProjectionUpsertResult(row: ChannelProjectionUpsertResult): {
    code: string;
    version: number;
  } {
    return {
      code: row.code,
      version: row.version,
    };
  }
}
