# üì¢ Slack Configuration for GS Notification# üß≠ Setting Up Slack for Notifications

This document provides complete setup instructions for integrating Slack notifications into the GS notification service.This guide explains how **consumers** (tenants or product users) can configure Slack to receive notifications from your platform. It walks through creating a Slack App, obtaining tokens securely, and connecting the workspace to the **Core Slack Config** service.

## üéØ Overview---

The Slack configuration enables real-time notifications to Slack channels for various events and alerts within the GS ecosystem. This integration supports:## üß© Overview

- **Event Notifications** ‚Äî System events, errors, and status updatesTo send Slack notifications from your environment, you must connect your Slack workspace to the system. This connection allows your organization‚Äôs channels (like `#approvals` or `#alerts`) to receive messages generated by workflows, events, or approvals.

- **Alert Management** ‚Äî Critical alerts and monitoring notifications

- **User Notifications** ‚Äî User-specific messages and updatesThe setup process involves:

- **Channel Routing** ‚Äî Dynamic routing to appropriate Slack channels

1. Creating a Slack App in your Slack workspace.

## üöÄ Quick Start2. Retrieving the **Bot Token** and **Signing Secret**.

3. Configuring your workspace in the **Core Slack Config** service.

### Prerequisites4. Optionally linking specific channels for targeted messages.

- Slack workspace with admin permissions---

- Node.js environment configured

- GS notification service deployed## ü™Ñ Step 1: Create a Slack App

### Setup Process1. Go to the [Slack API Apps dashboard](https://api.slack.com/apps).

2. Click **Create New App ‚Üí From Scratch**.

1. [Create Slack App](#-step-1-create-slack-app)3. Enter an **App Name** (e.g., `BankX Notification Bot`).

1. [Configure Permissions](#-step-2-configure-permissions)4. Choose the **Slack Workspace** you want to connect.

1. [Retrieve Credentials](#-step-3-retrieve-credentials)

1. [Environment Configuration](#-step-4-environment-configuration)You will now see your new app‚Äôs management dashboard.

1. [Deploy & Test](#-step-5-deploy--test)

---

---

## üîê Step 2: Add Required Permissions (OAuth Scopes)

## üîß Step 1: Create Slack App

In your app‚Äôs settings, navigate to **OAuth & Permissions**, then scroll to **Bot Token Scopes** and add the following permissions:

### 1.1 Navigate to Slack App Console

| Scope | Purpose |

Go to [https://api.slack.com/apps](https://api.slack.com/apps) and click **"Create New App"**.| ------------------- | ----------------------------------- |

| `chat:write` | Send messages as the bot. |

### 1.2 Choose Creation Method| `chat:write.public` | Send messages to public channels. |

| `channels:read` | List available channels. |

Select **"From scratch"** and provide:| `groups:read` | Access private channels (optional). |

| `im:read` | Read direct message conversations. |

- **App Name**: `GS Notification Service`| `mpim:read` | Read multi-person DMs (optional). |

- **Workspace**: Select your target Slack workspace

After adding scopes, click **Install App to Workspace**.

### 1.3 Basic Information

Authorize the app for your organization when prompted.

Complete the app details:

- **Short Description**: Real-time notifications for GS ecosystem---

- **Long Description**: Automated notification service for system events, alerts, and user communications

- **App Icon**: Upload your organization logo (optional)## üîë Step 3: Retrieve Credentials

---Once installed, Slack provides two critical credentials:

## üîë Step 2: Configure Permissions1. **Bot User OAuth Token** ‚Äî looks like:

### 2.1 OAuth & Permissions ```bash

xoxb-XXXXXXXXX-XXXXXXXXX-XXXXXXXXXXXXXXXXXXXXXXXX

Navigate to **"OAuth & Permissions"** in the left sidebar. ```

### 2.2 Bot Token Scopes This token authenticates API calls made by the notification service.

Add the following scopes under **"Bot Token Scopes"**:2. **Signing Secret** ‚Äî available under **Basic Information ‚Üí App Credentials**.

#### Required Scopes ```bash

````your_signing_secret_here

chat:write          # Send messages to channels   ```

chat:write.public   # Send messages to public channels

channels:read       # List public channels   Used to verify Slack requests and ensure authenticity.

groups:read         # List private channels

im:read            # List direct messages**Important:** Do not share these credentials publicly. Store them securely in your organization‚Äôs secret manager (e.g., Doppler, HashiCorp Vault, or AWS Secrets Manager).

mpim:read          # List group direct messages

users:read         # Read user information---

````

## ‚öôÔ∏è Step 4: Configure in Core Slack Config

#### Optional Scopes (for enhanced features)

```````Once you have the tokens, log into your application‚Äôs admin console or use the API endpoint to configure the workspace.

files:write        # Upload files/attachments

reactions:write    # Add emoji reactions### Example API Request

pins:write         # Pin important messages

``````bash

POST /api/slack/config

### 2.3 Install App to WorkspaceContent-Type: application/json

Authorization: Bearer <YOUR_JWT_TOKEN>

Click **"Install to Workspace"** and authorize the permissions.

{

---  "tenantId": "core",

  "workspaceId": "T0123456789",

## üîë Step 3: Retrieve Credentials  "workspaceName": "BankX Slack",

  "botTokenRef": "doppler://SLACK_BOT_TOKEN",

Once installed, Slack provides two critical credentials:  "signingSecretRef": "doppler://SLACK_SIGNING_SECRET",

  "defaultChannelId": "C1234567890",

1. **Bot User OAuth Token** ‚Äî looks like:  "enabled": true

}

   ```bash```

   xoxb-XXXXXXXXX-XXXXXXXXX-XXXXXXXXXXXXXXXXXXXXXXXX

   ```This will create or update the Slack workspace configuration in EventStoreDB and project it to Redis.



   This token authenticates API calls made by the notification service.---



2. **Signing Secret** ‚Äî available under **Basic Information ‚Üí App Credentials**.## üßµ Step 5: Link Channels



   ```bashTo allow notifications in specific channels:

   your_signing_secret_here

   ```1. Invite your bot to the desired channel:



   This secret validates webhook requests from Slack.   ```

   /invite @your-bot-name

---   ```



## ‚öôÔ∏è Step 4: Environment Configuration2. Ensure your bot has permission to post there.

3. (Optional) Configure channel subscriptions in the UI or via API:

### 4.1 Environment Variables

   ```bash

Add the following variables to your environment configuration:   POST /api/slack/channels

   {

```bash     "tenantId": "core",

# Slack Configuration     "workspaceId": "T0123456789",

SLACK_BOT_TOKEN=xoxb-your-actual-bot-token-here     "channelId": "C9876543210",

SLACK_SIGNING_SECRET=your-actual-signing-secret-here     "channelName": "#approvals",

SLACK_DEFAULT_CHANNEL=#general     "subscribedEvents": ["product.approved", "workflow.completed"]

SLACK_ERROR_CHANNEL=#alerts   }

SLACK_NOTIFICATION_ENABLED=true   ```



# Optional: Advanced Configuration---

SLACK_TIMEOUT=30000

SLACK_RETRY_ATTEMPTS=3## üß∞ Step 6: Test the Integration

SLACK_RATE_LIMIT_PER_MINUTE=60

```You can verify the setup by sending a test message.



### 4.2 Channel Configuration```bash

POST /api/slack/test

Define channel routing in your configuration:{

  "tenantId": "core",

```yaml  "workspaceId": "T0123456789",

slack:  "templateCode": "test_message",

  channels:  "recipient": "#alerts",

    default: "#general"  "data": { "message": "Slack integration is working!" }

    errors: "#alerts"}

    system: "#system-events"```

    user_notifications: "#notifications"

  routing:You should see a message appear in your Slack channel.

    error: ["#alerts", "#system-events"]

    warning: ["#alerts"]---

    info: ["#general"]

    user: ["#notifications"]## ‚úÖ Summary

```````

By completing these steps, you have:

---

- Created and configured a Slack App.

## üîÑ Step 5: Deploy & Test- Secured your tokens using a secret manager.

- Linked your Slack workspace with your application.

### 5.1 Service Deployment- Enabled channel-level subscriptions for notifications.

Deploy the notification service with the updated configuration.You‚Äôre now ready to receive automated messages for approvals, alerts, and workflow events in Slack.

### 5.2 Test Integration

Send a test notification:

```bash
curl -X POST http://your-service-url/api/notifications/test \
  -H "Content-Type: application/json" \
  -d '{
    "channel": "#general",
    "message": "üß™ GS Notification Service - Test Message",
    "type": "info"
  }'
```

### 5.3 Verify Channel Delivery

Check your Slack channels to confirm message delivery.

---

## üìã Configuration Reference

### Message Types

| Type      | Description                    | Default Channel  |
| --------- | ------------------------------ | ---------------- |
| `error`   | Critical errors and exceptions | `#alerts`        |
| `warning` | Warning messages               | `#alerts`        |
| `info`    | General information            | `#general`       |
| `success` | Success confirmations          | `#general`       |
| `user`    | User-specific notifications    | `#notifications` |

### Message Format

```typescript
interface SlackNotification {
  channel: string; // Target channel
  message: string; // Message content
  type: 'error' | 'warning' | 'info' | 'success' | 'user';
  metadata?: {
    userId?: string; // For user-specific messages
    timestamp?: string; // Event timestamp
    source?: string; // Message source system
    priority?: 'low' | 'medium' | 'high' | 'critical';
  };
  attachments?: SlackAttachment[];
}
```

---

## üõ†Ô∏è Advanced Configuration

### Custom Channel Routing

```typescript
const channelRouting = {
  // Route by message type
  error: ['#alerts', '#system-logs'],
  warning: ['#alerts'],

  // Route by source system
  'payment-service': ['#payments'],
  'user-service': ['#user-management'],

  // Route by priority
  critical: ['#alerts', '#on-call'],
  high: ['#alerts'],
};
```

### Message Templates

```typescript
const messageTemplates = {
  error: {
    color: 'danger',
    icon: ':rotating_light:',
    format:
      '{icon} *ERROR*: {message}\n*Source:* {source}\n*Time:* {timestamp}',
  },
  success: {
    color: 'good',
    icon: ':white_check_mark:',
    format: '{icon} *SUCCESS*: {message}',
  },
};
```

### Rate Limiting

```yaml
slack:
  rate_limiting:
    requests_per_minute: 60
    burst_limit: 10
    retry_after_seconds: 60
```

---

## üîí Security Considerations

### Token Management

- Store tokens in secure environment variables
- Rotate tokens regularly (quarterly recommended)
- Use least privilege principle for scopes

### Network Security

- Whitelist Slack IP ranges if using firewall rules
- Use HTTPS for all webhook endpoints
- Validate signing secrets for webhook requests

### Access Control

- Limit bot access to necessary channels only
- Review and audit channel permissions regularly
- Monitor bot activity logs

---

## üö® Troubleshooting

### Common Issues

#### 1. "Channel not found" Error

```
Solution: Ensure the bot is invited to the target channel
Command: /invite @GS-Notification-Service
```

#### 2. "Insufficient permissions" Error

```
Solution: Verify bot token scopes include required permissions
Check: OAuth & Permissions ‚Üí Bot Token Scopes
```

#### 3. Rate limiting errors

```
Solution: Implement exponential backoff in your service
Config: Reduce SLACK_RATE_LIMIT_PER_MINUTE value
```

#### 4. Messages not delivered

```
Checklist:
- ‚úÖ Bot token is valid and active
- ‚úÖ Channel exists and bot has access
- ‚úÖ Message format is valid JSON
- ‚úÖ No rate limits exceeded
```

### Debug Mode

Enable debug logging:

```bash
SLACK_DEBUG=true
LOG_LEVEL=debug
```

---

## üß™ cURL Examples for Testing

### Workspace Configuration

```bash
# Configure a new Slack workspace
curl -X POST http://localhost:3000/api/slack/workspace \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "id": "T01EXAMPLE123",
    "name": "Example Corp Engineering",
    "bot_token": "xoxb-EXAMPLE-EXAMPLE-EXAMPLETOKEN123456",
    "signing_secret": "example_signing_secret_not_real_123",
    "app_id": "A01EXAMPLE456",
    "bot_user_id": "U01EXAMPLE789",
    "default_channel_id": "C01EXAMPLE000",
    "enabled": true
  }'
```

### Channel Configuration

```bash
# Add a notification channel
curl -X POST http://localhost:3000/api/slack/channel \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "id": "C01EXAMPLE001",
    "name": "#notifications",
    "workspace_id": "T01EXAMPLE123",
    "is_private": false,
    "is_dm": false,
    "topic": "System notifications and alerts",
    "purpose": "Automated notifications for production systems",
    "subscribed_events": ["user.created", "payment.failed", "system.error"],
    "enabled": true
  }'
```

### Message Template Configuration

```bash
# Create a message template
curl -X POST http://localhost:3000/api/slack/template \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "code": "payment_failure_alert",
    "workspace_id": "T01EXAMPLE123",
    "name": "Payment Failure Alert",
    "description": "Alert template for payment processing failures requiring immediate attention",
    "content_blocks": [
      {
        "type": "section",
        "text": {
          "type": "mrkdwn",
          "text": "*Payment Failed* \n Transaction {{transactionId}} failed"
        }
      }
    ],
    "variables": ["transactionId", "amount", "customerEmail", "errorCode"],
    "sample_payload": {
      "transactionId": "TXN-EXAMPLE123",
      "amount": "$99.99",
      "customerEmail": "example@domain.com",
      "errorCode": "CARD_DECLINED"
    },
    "enabled": true
  }'
```

### App Configuration

```bash
# Configure app settings
curl -X POST http://localhost:3000/api/slack/app-config \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "workspace_id": "T01EXAMPLE123",
    "max_retry_attempts": 3,
    "retry_backoff_seconds": 5,
    "default_locale": "en_US",
    "logging_enabled": true,
    "audit_channel_id": "C01EXAMPLE999",
    "metadata": {
      "timezone": "America/New_York",
      "businessHours": {
        "start": "09:00",
        "end": "17:00"
      },
      "features": {
        "threadedReplies": true
      }
    }
  }'
```

### Test Message Sending

```bash
# Send a test notification
curl -X POST http://localhost:3000/api/slack/send \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "workspace_id": "T01EXAMPLE123",
    "channel_id": "C01EXAMPLE001",
    "template_code": "payment_failure_alert",
    "variables": {
      "transactionId": "TXN-EXAMPLE123",
      "amount": "$99.99",
      "customerEmail": "example@domain.com",
      "errorCode": "CARD_DECLINED"
    }
  }'
```

### Verify Configuration

```bash
# Get workspace configuration
curl -X GET http://localhost:3000/api/slack/workspace/T01EXAMPLE123 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# List all channels for workspace
curl -X GET http://localhost:3000/api/slack/workspace/T01EXAMPLE123/channels \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# Get template details
curl -X GET http://localhost:3000/api/slack/template/payment_failure_alert \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Health Check

```bash
# Check Slack integration health
curl -X GET http://localhost:3000/api/slack/health \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

‚ö†Ô∏è **Security Note**: These examples use fake credentials that are clearly marked as examples. Never use real Slack tokens in documentation, curl examples, or public repositories. Always use environment variables or secure secret management systems for actual credentials.

---

## üìö Additional Resources

- [Slack API Documentation](https://api.slack.com/)
- [Bot Token Scopes Reference](https://api.slack.com/scopes)
- [Slack Block Kit Builder](https://app.slack.com/block-kit-builder)
- [Webhook Configuration Guide](https://api.slack.com/messaging/webhooks)

---

## üìû Support

For issues related to this integration:

1. Check the troubleshooting section above
2. Review Slack API logs in your service
3. Contact the development team with:
   - Error messages and logs
   - Steps to reproduce the issue
   - Current environment configuration

---

_Last updated: October 2025_
