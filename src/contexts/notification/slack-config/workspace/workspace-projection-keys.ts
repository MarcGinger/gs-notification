// @generated by gen v1.0.0 hash:regen
// REMOVE THIS COMMENT TO STOP AUTOMATIC UPDATES TO THIS BLOCK

import { SlackConfigServiceConstants } from '../service-constants';
/**
 * Domain value object for Workspace projection keys
 * Centralizes all key patterns to prevent duplication and ensure consistency
 * Follows DDD principle of explicit domain concepts
 */
export class WorkspaceProjectionKeys {
  // EventStore DB patterns
  static readonly ESDB_BOUNDED_CONTEXT =
    SlackConfigServiceConstants.BOUNDED_CONTEXT;
  static readonly ESDB_AGGREGATE_NAME = 'workspace';
  static readonly ESDB_VERSION = 'v1';

  /**
   * Get EventStore stream prefix for individual streams
   * Format: <boundedContext>.<aggregate>.<version>
   * Example: slack-config.workspace.v1
   */
  static getEventStoreStreamPrefix(): string {
    return `${this.ESDB_BOUNDED_CONTEXT}.${this.ESDB_AGGREGATE_NAME}.${this.ESDB_VERSION}`;
  }

  /**
   * Get EventStore category projection pattern for catchup
   * Format: $ce-<boundedContext>.<aggregate>.<version>
   * Example: $ce-slack-config.workspace.v1
   */
  static getEventStoreCategoryPattern(): string {
    return `$ce-${this.getEventStoreStreamPrefix()}`;
  }

  /**
   * Get individual EventStore stream name for specific tenant and code
   * Format: <boundedContext>.<aggregate>.<version>-{tenant}-{code}
   * Example: slack-config.workspace.v1-tenant-12345
   */
  static getEventStoreStreamName(tenant: string, code: string): string {
    return `${this.getEventStoreStreamPrefix()}-${tenant}-${code}`;
  }

  /**
   * Extract tenant and code from EventStore stream name
   * Validates format: <boundedContext>.<aggregate>.<version>-{tenant}-{code}
   */
  static extractFromStreamName(
    streamName: string,
  ): { tenant: string; code: string } | null {
    const prefix = this.getEventStoreStreamPrefix();
    const pattern = new RegExp(
      `^${prefix.replace(/\./g, '\\.')}-([^-]+)-(.+)$`,
    );
    const match = streamName.match(pattern);
    if (!match) return null;

    const [, tenant, code] = match;
    return { tenant, code };
  }

  /**
   * Validate if stream name matches workspace pattern
   */
  static isWorkspaceStream(streamName: string): boolean {
    return this.extractFromStreamName(streamName) !== null;
  }

  /**
   * Get stream pattern for tenant-specific catchup
   * Format: <boundedContext>.<aggregate>.<version>-{tenant}-*
   */
  static getTenantStreamPattern(tenant: string): string {
    return `${this.getEventStoreStreamPrefix()}-${tenant}-*`;
  }

  /**
   * Get global stream pattern for all tenants
   * Format: <boundedContext>.<aggregate>.<version>-*
   */
  static getGlobalStreamPattern(): string {
    return `${this.getEventStoreStreamPrefix()}-*`;
  }

  // Redis projection key patterns
  static readonly REDIS_KEY_PREFIX = 'notification.slack';
  static readonly REDIS_VERSION = 'v1';
  static readonly PROJECTOR_NAME = 'workspace-projector';
  static readonly SUBSCRIPTION_GROUP = 'workspace-projection';

  /**
   * Get Redis key for workspace projection with cluster-safe hash tags
   * Format: notification.slack:v1:{tenantId}:workspace:{workspaceId}
   */
  static getRedisWorkspaceKey(tenantId: string, workspaceId: string): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:{${tenantId}}:workspace:${workspaceId}`;
  }

  /**
   * Get Redis key for workspace index with cluster-safe hash tags
   * Format: notification.slack:v1:{tenantId}:idx:workspace:list
   */
  static getRedisWorkspaceIndexKey(tenantId: string): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:{${tenantId}}:idx:workspace:list`;
  }

  /**
   * Get Redis key for category-based workspace index with cluster-safe hash tags
   * Format: notification.slack:v1:{tenantId}:idx:workspace:by-category:{category}
   */
  static getRedisCategoryIndexKey(tenantId: string, category: string): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:{${tenantId}}:idx:workspace:by-category:${category}`;
  }

  /**
   * Get Redis key pattern for all workspaces in a tenant
   * Format: notification.slack:v1:{tenantId}:workspace:*
   */
  static getRedisTenantWorkspacePattern(tenantId: string): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:{${tenantId}}:workspace:*`;
  }

  /**
   * Get Redis key pattern for all workspace projections
   * Format: notification.slack:v1:*:workspace:*
   */
  static getRedisAllWorkspacesPattern(): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:*:workspace:*`;
  }

  /**
   * Get Redis key pattern for all projections in a specific tenant
   * Format: notification.slack:v1:{tenantId}:*
   */
  static getRedisTenantPattern(tenantId: string): string {
    return `${this.REDIS_KEY_PREFIX}:${this.REDIS_VERSION}:{${tenantId}}:*`;
  }

  /**
   * Get Redis key pattern for all slack projections
   * Format: notification.slack:*
   */
  static getRedisSlackPattern(): string {
    return `${this.REDIS_KEY_PREFIX}:*`;
  }

  // Migration helpers - for transitioning from old keys to new keys

  /**
   * Get old Redis key format for workspace (for migration purposes)
   * Format: notification:workspace-projector:{tenantId}:workspace:{workspaceId}
   */
  static getOldRedisWorkspaceKey(
    tenantId: string,
    workspaceId: string,
  ): string {
    return `notification:workspace-projector:{${tenantId}}:workspace:${workspaceId}`;
  }

  /**
   * Get old Redis key format for workspace index (for migration purposes)
   * Format: notification:workspace-projector:{tenantId}:workspace-index
   */
  static getOldRedisWorkspaceIndexKey(tenantId: string): string {
    return `notification:workspace-projector:{${tenantId}}:workspace-index`;
  }

  /**
   * Get old pp key format (for migration purposes)
   * Format: pp:{tenantId}:workspace:{workspaceId}
   */
  static getOldPpKey(tenantId: string, workspaceId: string): string {
    return `pp:{${tenantId}}:workspace:${workspaceId}`;
  }

  /**
   * Get old version key format (for migration purposes)
   * Format: ver:{tenantId}:workspace:{workspaceId}
   */
  static getOldVersionKey(tenantId: string, workspaceId: string): string {
    return `ver:{${tenantId}}:workspace:${workspaceId}`;
  }

  /**
   * Get all old key patterns for cleanup/migration
   */
  static getOldKeyPatterns(): string[] {
    return [
      'notification:workspace-projector:*',
      'notification:workspace-index:*',
      'pp:*:workspace:*',
      'ver:*:workspace:*',
    ];
  }
}
